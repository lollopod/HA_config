esphome:
  name: bedroom
  platform: ESP8266
  board: nodemcuv2
#  includes:
#    - PanasonicClimate.h

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_pw

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Bedroom Fallback Hotspot"
    password: "YETCflVKEBkY"

captive_portal:

# Enable logging
logger:
  level: DEBUG

# Enable Home Assistant API
api:
  services:
    - service: send_raw_command
      variables:
        command: int[]
      then:
        - remote_transmitter.transmit_raw:
            code: !lambda 'return command;'

ota:


#switch:
#  - platform: gpio
#    name: "Green LED"
#    pin: D2
#  - platform: gpio
#    name: "IR LEDs"
#    pin: D2
remote_transmitter:
  pin: D2
  carrier_duty_percent: 50%
  id: ir_transmitter

# Individual switches
#switch:
#  - platform: template
#    name: "Panasonic AirCon Heat"
#    turn_on_action:
#      remote_transmitter.transmit_panasonic:
#        address: 0x4004
#        command: 0x100BCBD
          
# Example configuration entry
sensor:
  - platform: dht
    pin: D7
    model: AM2302
    temperature:
      name: "Temperatura Camera"
      id: bedroom_temp
    humidity:
      name: "Umidit√† camera"
    update_interval: 60s
  - platform: ultrasonic
    trigger_pin: D5
    echo_pin: D6
    name: "Distanza scrivania"
    timeout: 1.5m
    id: distance
#  - platform: template
#    name: "Distanza filtrata"
#    lambda: |-
#      if (id(distance).state == NAN) {
#        return 2;
#      } else {
#        return id(distance).state;
#      }
#    update_interval: 60s
binary_sensor:
  - platform: template
    name: "Presenza scrivania"
    lambda: |-
      if (id(distance).state < 1 ) {
        return true;
      } else {
        return false;
      }
    filters:
     - delayed_on_off: 180s
    
#remote_receiver:
#  pin:
#    number: D1
#    inverted: True
#    mode: INPUT_PULLUP
#  dump:
#   - raw
#   - panasonic


switch:
  - platform: template
    id: bedroom_heater
    name: Bedroom Heater
    #optimistic: true
    assumed_state: true
    turn_on_action:
      - remote_transmitter.transmit_raw:
          carrier_frequency: 38kHz
          code: [3516, -1695, 466, -397, 465, -1264, 491, -372, 466, -399, 490, -374, 490, -373, 466, -398, 465, -399, 490, -373, 466, -399, 491, -400, 490, -374, 465, -398, 466, -1262, 466, -398, 465, -399, 490, -374, 465, -399, 465, -398, 466, -398, 492, -372, 465, -1263, 466, -1262, 466, -1263, 490, -372, 492, -399, 467, -1261, 465, -399, 466, -398, 491, -372, 481, -384, 465, -400, 464, -398, 466, -399, 491, -372, 466, -398, 492, -372, 466, -398, 466, -398, 490, -374, 491, -400, 465, -399, 465, -398, 491, -373, 490, -375, 490, -374, 464, -400, 491, -372, 493, -371, 491, -373, 491, -373, 492, -372, 492, -372, 464, -400, 493, -397, 466, -398, 465, -399, 492, -1236, 491, -1236, 493, -371, 466, -399, 490, -374, 490, -373, 493, -371, 491, -9902, 3571, -1640, 493, -371, 492, -1236, 492, -398, 466, -398, 467, -397, 466, -398, 466, -398, 467, -397, 466, -398, 492, -372, 492, -372, 466, -398, 490, -373, 467, -1261, 466, -398, 466, -398, 494, -397, 492, -372, 493, -371, 492, -371, 468, -397, 493, -1234, 493, -1235, 492, -1235, 493, -372, 492, -372, 466, -1261, 493, -371, 466, -398, 492, -372, 467, -397, 492, -372, 520, -371, 466, -398, 466, -398, 466, -397, 493, -371, 467, -398, 466, -398, 466, -397, 493, -1235, 466, -398, 493, -370, 493, -1236, 492, -372, 466, -398, 519, -1209, 493, -397, 467, -397, 467, -398, 465, -1262, 491, -1236, 467, -1261, 492, -1236, 492, -372, 493, -371, 492, -373, 490, -373, 493, -371, 467, -398, 490, -374, 491, -372, 519, -372, 467, -1261, 465, -1263, 492, -372, 490, -374, 466, -398, 492, -372, 466, -1262, 492, -372, 490, -1238, 491, -373, 492, -371, 491, -1237, 466, -1263, 489, -374, 465, -400, 492, -397, 471, -394, 491, -373, 464, -400, 490, -374, 465, -399, 491, -373, 465, -399, 464, -399, 491, -374, 492, -372, 464, -1263, 465, -1263, 491, -1237, 465, -398, 494, -398, 464, -400, 489, -375, 464, -400, 464, -399, 465, -400, 464, -400, 462, -402, 464, -1264, 488, -1239, 464, -1264, 464, -400, 464, -401, 462, -401, 490, -374, 491, -401, 461, -403, 488, -376, 460, -403, 462, -402, 463, -401, 410, -454, 461, -403, 461, -403, 462, -402, 461, -403, 410, -453, 461, -1268, 461, -403, 487, -403, 462, -1266, 411, -452, 412, -453, 460, -404, 410, -1318, 410, -454, 460, -404, 460, -404, 460, -403, 463, -402, 410, -453,  411, -454, 461, -402, 411, -454, 437, -453, 461, -403, 461, -403, 460, -404, 460, -404, 410, -453, 463, -402, 460, -1267, 462, -1266, 461, -1267, 460, -1268, 410, -453, 462, -1266, 411, -453, 461, -403, 411]
    turn_off_action:
      - remote_transmitter.transmit_raw:
          carrier_frequency: 38kHz
          code: [3463, -1748, 411, -455, 409, -1319, 409, -454, 410, -455, 409, -454, 410, -454, 409, -455, 409, -455, 409, -455, 409, -455, 435, -455, 410, -455, 409, -454, 410, -1318, 410, -454, 409, -455, 410, -454, 409, -455, 409, -455, 408, -455, 410, -454, 410, -1318, 410, -1318, 410, -1318, 411, -453, 437, -454, 409, -1319, 409, -454, 410, -454, 410, -454, 410, -455, 408, -455, 410, -454, 409, -455, 410, -454, 409, -455, 409, -455, 409, -455, 409, -454, 410, -455, 435, -456, 409, -454, 410, -454, 410, -454, 409, -455, 436, -428, 409, -455, 409, -454, 410, -455, 409, -455, 409, -455, 407, -457, 409, -454, 410, -455, 436, -454, 409, -455, 410, -454, 409, -1319, 410, -1317, 410, -455, 436, -428, 409, -455, 408, -455, 409, -455, 409, -9984, 3487, -1724, 409, -455, 410, -1318, 437, -454, 410, -455, 408, -455, 409, -455, 409, -454, 411, -454, 409, -454, 409, -456, 410, -454, 409, -455, 409, -454, 409, -1319, 410, -455, 409, -454, 437, -454, 409, -454, 411, -454, 409, -456, 408, -455, 409, -1318, 410, -1318, 410, -1318, 411, -453, 410, -454, 409, -1319, 410, -454, 409, -454, 410, -455, 409, -454, 410, -455, 436, -455, 409, -454, 409, -455, 409, -455, 409, -455, 410, -454, 409, -455, 410, -453, 410, -454, 409, -455, 410, -455, 409, -1318, 409, -455, 409, -455, 437, -1318, 410, -454, 410, -454, 417, -447, 436, -1291, 411, -1317, 411, -1317, 411, -1317, 411, -453, 412, -452, 411, -453, 411, -453, 411, -453, 411, -453, 411, -453, 411, -452, 439, -452, 412, -1316, 412, -1316, 412, -453, 412, -451, 412, -452, 412, -452, 412, -1316, 412, -451, 413, -1316, 411, -452, 412, -452, 411, -1317, 412, -1315, 412, -452, 411, -453, 438, -453, 412, -452, 411, -452, 412, -452, 412, -452, 412, -452, 412, -452, 411, -453, 411, -453, 411, -452, 412, -452, 411, -1317, 411, -1317, 411, -1316, 411, -453, 439, -452, 411, -453, 411, -453, 411, -452, 411, -454, 411, -453, 410, -454, 410, -453, 411, -1317, 460, -1267, 412, -1316, 411, -453, 411, -454, 411, -452, 411, -454, 437, -453, 411, -453, 411, -453, 411,  -453, 411, -454, 410, -453, 411, -453, 411, -453, 411, -453, 410, -454, 411, -453, 411, -453, 410, -1317, 411, -454, 438, -452, 412, -1317, 410, -453, 411, -453, 411, -454, 410, -1317, 411, -453, 411, -453, 411, -453, 411, -452, 412, -453, 411, -452, 412, -453, 411, -453, 411, -453, 439, -451, 412, -453, 411, -452, 412, -452, 412, -452, 412, -453, 411, -452, 412, -452, 412, -1316, 411, -1317, 411, -1317, 411, -452, 412, -1316, 411, -453, 411, -453, 438]
 
  - platform: template
    id: bedroom_heater_quiet
    name: Bedroom Heater Quiet
    #optimistic: true
    assumed_state: true
    turn_on_action:
      - remote_transmitter.transmit_raw:
          carrier_frequency: 38kHz
          code: [3465, -1747, 413, -452, 412, -1315, 412, -452, 412, -452, 412, -452, 413, -451, 414, -450, 413, -451, 412, -451, 442, -422, 440, -451, 413, -452, 440, -424, 440, -1287, 443, -421, 443, -422, 442, -421, 469, -396, 469, -394, 444, -420, 443, -420, 445, -1283, 444, -1284, 444, -1284, 442, -422, 495, -395, 442, -1287, 443, -421, 442, -422, 441, -423, 442, -421, 443, -421, 468, -396, 443, -422, 441, -422, 469, -395, 469, -395, 441, -423, 442, -421, 443, -421, 471, -421, 442, -422, 441, -422, 442, -422, 443, -421, 442, -421, 442, -423, 441, -423, 442, -421, 442, -422, 443, -421, 443, -421, 442, -422, 443, -421, 469, -422, 442, -421, 443, -422, 468, -1259, 443, -1285, 469, -395, 443, -421, 444, -420, 442, -421, 467, -397, 468, -9925, 3520, -1690, 444, -421, 443, -1284, 496, -395, 443, -421, 442, -421, 444, -421, 441, -423, 468, -395, 443, -421, 442, -422, 442, -422, 468, -396, 442, -422, 441, -1286, 442, -422, 444, -420, 468, -423, 468, -396, 466, -398, 441, -423, 441, -422, 441, -1287,  440, -1288, 439, -1288, 441, -424, 441, -422, 441, -1286, 441, -424, 440, -424, 440, -424, 439, -424, 440, -424, 467, -424, 440, -424, 465, -399, 440, -424, 438, -425, 440, -424, 439, -425, 440, -424, 438, -1289, 439, -426, 438, -426, 437, -1290, 439, -425, 439, -426, 464, -1263, 465, -426, 437, -427, 438, -426, 438, -1289, 437, -1291, 437, -1291, 436, -1291, 437, -428, 436, -428, 437, -426, 437, -427, 437, -427, 436, -428, 436, -428, 436, -428, 463, -427, 436, -1293, 435, -1293, 435, -429, 435, -429, 435, -428, 436, -428, 435, -1293, 434, -430, 435, -1292, 436, -429, 435, -429, 435, -1292, 436, -1292, 435, -429, 434, -430, 461, -430, 434, -430, 434, -429, 435, -430, 435, -429, 433, -430, 435, -429, 434, -430, 434, -430, 434, -430, 434, -430, 434, -1294, 434, -1293, 435, -1293, 434, -430, 461, -430, 434, -430, 434, -430, 434, -430, 434, -430, 433, -430, 434, -431, 433, -430, 434, -1294, 434, -1293, 434, -1294, 434, -430, 434, -430, 434, -431, 433, -430, 461, -430, 434, -1294, 433, -431,  433, -431, 433, -431, 433, -430, 434, -430, 434, -431, 433, -430, 433, -431, 433, -431, 433, -431, 433, -1295, 433, -431, 433, -431, 459, -1295, 433, -432, 432, -431, 433, -431, 433, -1295, 433, -431, 433, -431, 433, -431, 433, -430, 433, -432, 432, -432, 432, -431, 433, -432, 431, -432, 460, -431, 432, -432, 433, -431, 432, -432, 432, -432, 432, -432, 432, -431, 433, -1295, 432, -1296, 432, -1296, 432, -1296, 432, -432, 431, -433, 432, -1295, 433, -432, 432]
    turn_off_action:
      - remote_transmitter.transmit_raw:
          carrier_frequency: 38kHz
          code: [3463, -1748, 411, -455, 409, -1319, 409, -454, 410, -455, 409, -454, 410, -454, 409, -455, 409, -455, 409, -455, 409, -455, 435, -455, 410, -455, 409, -454, 410, -1318, 410, -454, 409, -455, 410, -454, 409, -455, 409, -455, 408, -455, 410, -454, 410, -1318, 410, -1318, 410, -1318, 411, -453, 437, -454, 409, -1319, 409, -454, 410, -454, 410, -454, 410, -455, 408, -455, 410, -454, 409, -455, 410, -454, 409, -455, 409, -455, 409, -455, 409, -454, 410, -455, 435, -456, 409, -454, 410, -454, 410, -454, 409, -455, 436, -428, 409, -455, 409, -454, 410, -455, 409, -455, 409, -455, 407, -457, 409, -454, 410, -455, 436, -454, 409, -455, 410, -454, 409, -1319, 410, -1317, 410, -455, 436, -428, 409, -455, 408, -455, 409, -455, 409, -9984, 3487, -1724, 409, -455, 410, -1318, 437, -454, 410, -455, 408, -455, 409, -455, 409, -454, 411, -454, 409, -454, 409, -456, 410, -454, 409, -455, 409, -454, 409, -1319, 410, -455, 409, -454, 437, -454, 409, -454, 411, -454, 409, -456, 408, -455, 409, -1318, 410, -1318, 410, -1318, 411, -453, 410, -454, 409, -1319, 410, -454, 409, -454, 410, -455, 409, -454, 410, -455, 436, -455, 409, -454, 409, -455, 409, -455, 409, -455, 410, -454, 409, -455, 410, -453, 410, -454, 409, -455, 410, -455, 409, -1318, 409, -455, 409, -455, 437, -1318, 410, -454, 410, -454, 417, -447, 436, -1291, 411, -1317, 411, -1317, 411, -1317, 411, -453, 412, -452, 411, -453, 411, -453, 411, -453, 411, -453, 411, -453, 411, -452, 439, -452, 412, -1316, 412, -1316, 412, -453, 412, -451, 412, -452, 412, -452, 412, -1316, 412, -451, 413, -1316, 411, -452, 412, -452, 411, -1317, 412, -1315, 412, -452, 411, -453, 438, -453, 412, -452, 411, -452, 412, -452, 412, -452, 412, -452, 412, -452, 411, -453, 411, -453, 411, -452, 412, -452, 411, -1317, 411, -1317, 411, -1316, 411, -453, 439, -452, 411, -453, 411, -453, 411, -452, 411, -454, 411, -453, 410, -454, 410, -453, 411, -1317, 460, -1267, 412, -1316, 411, -453, 411, -454, 411, -452, 411, -454, 437, -453, 411, -453, 411, -453, 411,  -453, 411, -454, 410, -453, 411, -453, 411, -453, 411, -453, 410, -454, 411, -453, 411, -453, 410, -1317, 411, -454, 438, -452, 412, -1317, 410, -453, 411, -453, 411, -454, 410, -1317, 411, -453, 411, -453, 411, -453, 411, -452, 412, -453, 411, -452, 412, -453, 411, -453, 411, -453, 439, -451, 412, -453, 411, -452, 412, -452, 412, -452, 412, -453, 411, -452, 412, -452, 412, -1316, 411, -1317, 411, -1317, 411, -452, 412, -1316, 411, -453, 411, -453, 438]
        
#climate:       
#climate:
#  - platform: custom
#    lambda: |-
#      auto panasonic_climate = new PanasonicClimate();
#      panasonic_climate->set_sensor(id(bedroom_temp)); // Optional
#      panasonic_climate->set_transmitter(id(ir_transmitter));
#      App.register_component(panasonic_climate);
#      return {panasonic_climate};

#    climates:
#      - name: "My Panasonic AC"